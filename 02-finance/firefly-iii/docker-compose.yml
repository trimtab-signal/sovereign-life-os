services:
  firefly:
    image: fireflyiii/core:latest
    container_name: firefly-iii
    ports:
      - "${PORT:-8080}:8080"
    volumes:
      - ./data/upload:/var/www/html/storage/upload
    environment:
      - APP_KEY=${APP_KEY:-CHANGEME_32_CHAR_RANDOM_STRING_HERE}
      - DB_CONNECTION=sqlite
      - DB_DATABASE=/var/www/html/storage/database/database.sqlite
      - APP_URL=http://localhost:${PORT:-8080}
      - TRUSTED_PROXIES=**
    restart: unless-stopped

  importer:
    image: fireflyiii/data-importer:latest
    container_name: firefly-importer
    ports:
      - "8081:8080"
    environment:
      - FIREFLY_III_URL=http://firefly:8080
      - FIREFLY_III_ACCESS_TOKEN=${API_TOKEN:-}
    depends_on:
      - firefly
    restart: unless-stopped
